<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Owner Dashboard | Kozeyy</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@500;700;800&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        
        /* Apply friendly brand font to headings */
        h1, h2, h3, h4, .brand-font { font-family: 'Outfit', sans-serif; }
        
        .sidebar-active { background-color: #312e81; border-left: 4px solid #6366f1; color: white !important; }
        .nav-item { color: #94a3b8; }
        .nav-item:hover { color: white; background-color: #312e81; }
        .hidden-section { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
        
        /* Mobile Overlay */
        #mobile-overlay { background-color: rgba(0,0,0,0.5); }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-slate-800 bg-slate-50">

    <!-- MOBILE OVERLAY -->
    <div id="mobile-overlay" onclick="toggleSidebar()" class="fixed inset-0 z-40 hidden transition-opacity backdrop-blur-sm md:hidden"></div>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-indigo-950 flex flex-col transition-transform duration-300 transform -translate-x-full md:translate-x-0 md:static shadow-xl">
        <div class="h-20 flex items-center justify-between px-6 border-b border-indigo-900 bg-indigo-950">
            <div class="flex items-center gap-3">
                <svg width="32" height="32" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="6" y="6" width="10" height="28" rx="2" fill="#6366f1" />
                    <path d="M18 18L30 6H34C35.1046 6 36 6.89543 36 8V10L22 22H18V18Z" fill="#6366f1" fill-opacity="0.8" />
                    <path d="M22 24L36 38V40C36 41.1046 35.1046 42 34 42H30L18 30V24H22Z" transform="translate(0 -2)" fill="#6366f1" fill-opacity="0.9" />
                </svg>
                <span class="text-xl font-bold text-white tracking-tight brand-font">Kozeyy</span>
            </div>
            <button onclick="toggleSidebar()" class="md:hidden text-slate-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-6 space-y-1">
            <a href="#" onclick="navTo('dashboard')" id="link-dashboard" class="nav-item flex items-center justify-between px-6 py-3.5 transition sidebar-active"><div class="flex items-center"><i class="fas fa-th-large w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Dashboard</span></div></a>
            <a href="#" onclick="navTo('tenants')" id="link-tenants" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-users w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Tenants</span></div></a>
            <a href="#" onclick="navTo('listings')" id="link-listings" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-sign w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Listings</span></div></a>
            <a href="#" onclick="navTo('screening')" id="link-screening" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-user-check w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Screening</span></div><span id="badge-screening" class="hidden-section bg-rose-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full">0</span></a>
            <a href="#" onclick="navTo('messages')" id="link-messages" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-comment-dots w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Messages</span></div><span id="badge-messages" class="hidden-section bg-rose-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full">0</span></a>
            <a href="#" onclick="navTo('maintenance')" id="link-maintenance" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-tools w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Maintenance</span></div><span id="badge-maintenance" class="hidden-section bg-rose-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full">0</span></a>
            <a href="#" onclick="navTo('financials')" id="link-financials" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-money-bill-wave w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Records</span></div></a>
            <a href="#" onclick="navTo('expenses')" id="link-expenses" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-receipt w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Expenses</span></div></a>
            <a href="#" onclick="navTo('reports')" id="link-reports" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-chart-pie w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Reports</span></div></a>
            <a href="#" onclick="navTo('settings')" id="link-settings" class="nav-item flex items-center justify-between px-6 py-3.5 transition"><div class="flex items-center"><i class="fas fa-sliders-h w-5"></i> <span class="font-medium ml-3 text-sm brand-font">Settings</span></div></a>
        </nav>
        <div class="p-6 border-t border-indigo-900 bg-indigo-950 flex flex-col gap-2">
            <button onclick="hardReset()" class="flex items-center text-xs text-indigo-300 hover:text-white transition"><i class="fas fa-trash-alt mr-2"></i> Reset System</button>
            <button onclick="restartTour()" class="flex items-center text-xs text-indigo-300 hover:text-white transition"><i class="fas fa-play-circle mr-2"></i> Replay Tour</button>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col overflow-hidden relative w-full">
        <header class="h-20 bg-white border-b border-slate-200 flex items-center justify-between px-4 md:px-8 shadow-sm z-10 sticky top-0">
            <div class="flex items-center gap-3">
                <!-- Hamburger Menu Button -->
                <button onclick="toggleSidebar()" class="md:hidden text-slate-700 hover:text-indigo-600 focus:outline-none p-2 -ml-2 rounded-xl hover:bg-slate-50 transition">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <!-- Title Logic: "Menu" on mobile, Page Title on Desktop -->
                <h2 class="text-xl md:text-xl font-bold text-slate-800 brand-font truncate" id="header-title">
                    <span class="md:hidden">Menu</span>
                    <span class="hidden md:inline" id="desktop-page-title">Portfolio Overview</span>
                </h2>
            </div>
            
            <div class="flex items-center gap-4 md:gap-6">
                <div class="relative cursor-pointer hover:text-indigo-600 transition" onclick="clearNotifications()">
                    <i class="fas fa-bell text-xl text-slate-400"></i>
                    <span id="notif-badge" class="hidden absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"></span>
                </div>
                <div class="flex items-center gap-3 md:pl-6 md:border-l border-slate-200">
                    <div class="text-right hidden md:block"><p class="text-sm font-bold text-slate-700 brand-font">James Dalton</p><p class="text-xs text-slate-500">Property Owner</p></div>
                    <div class="w-9 h-9 md:w-10 md:h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold shadow-md text-sm brand-font">JD</div>
                </div>
            </div>
        </header>

        <!-- Added pb-32 to fully clear mobile bottom bars -->
        <div class="flex-1 overflow-y-auto p-4 md:p-8 bg-slate-50 scroll-smooth pb-32" id="app-content">
            
            <!-- 1. DASHBOARD -->
            <div id="view-dashboard" class="view-section fade-in">
                <!-- UPDATED: Livelier Mobile Squares (2 cols) -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-8">
                    
                    <!-- Revenue Card (Green) -->
                    <div class="bg-gradient-to-br from-emerald-50 to-white p-4 md:p-6 rounded-3xl shadow-sm border border-emerald-100 flex flex-col justify-between h-36 relative overflow-hidden">
                        <div class="absolute -right-3 -top-3 w-16 h-16 bg-emerald-100 rounded-full opacity-50 blur-xl"></div>
                        <div class="relative z-10">
                            <div class="w-8 h-8 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center text-xs mb-2"><i class="fas fa-dollar-sign"></i></div>
                            <p class="text-emerald-800 text-[11px] font-bold uppercase tracking-wider brand-font">Revenue</p>
                            <h3 class="text-2xl md:text-3xl font-extrabold text-slate-900 brand-font" id="dash-revenue">$0.00</h3>
                        </div>
                    </div>

                    <!-- Outstanding Card (Rose) -->
                    <div class="bg-gradient-to-br from-rose-50 to-white p-4 md:p-6 rounded-3xl shadow-sm border border-rose-100 flex flex-col justify-between h-36 relative overflow-hidden">
                        <div class="absolute -right-3 -top-3 w-16 h-16 bg-rose-100 rounded-full opacity-50 blur-xl"></div>
                        <div class="relative z-10">
                            <div class="w-8 h-8 bg-rose-100 text-rose-600 rounded-full flex items-center justify-center text-xs mb-2"><i class="fas fa-exclamation"></i></div>
                            <p class="text-rose-800 text-[11px] font-bold uppercase tracking-wider brand-font">Pending</p>
                            <h3 class="text-2xl md:text-3xl font-extrabold text-slate-900 brand-font" id="dash-outstanding">$0.00</h3>
                        </div>
                    </div>

                    <!-- Occupancy Card (Indigo) -->
                    <div class="bg-gradient-to-br from-indigo-50 to-white p-4 md:p-6 rounded-3xl shadow-sm border border-indigo-100 flex flex-col justify-between h-36 relative overflow-hidden">
                        <div class="absolute -right-3 -top-3 w-16 h-16 bg-indigo-100 rounded-full opacity-50 blur-xl"></div>
                        <div class="relative z-10">
                            <div class="w-8 h-8 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-xs mb-2"><i class="fas fa-home"></i></div>
                            <p class="text-indigo-800 text-[11px] font-bold uppercase tracking-wider brand-font">Occupancy</p>
                            <h3 class="text-2xl md:text-3xl font-extrabold text-slate-900 brand-font" id="dash-occupancy">0%</h3>
                        </div>
                    </div>

                    <!-- Maintenance Card (Amber) -->
                    <div class="bg-gradient-to-br from-amber-50 to-white p-4 md:p-6 rounded-3xl shadow-sm border border-amber-100 flex flex-col justify-between h-36 relative overflow-hidden">
                        <div class="absolute -right-3 -top-3 w-16 h-16 bg-amber-100 rounded-full opacity-50 blur-xl"></div>
                        <div class="relative z-10">
                            <div class="w-8 h-8 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center text-xs mb-2"><i class="fas fa-tools"></i></div>
                            <p class="text-amber-800 text-[11px] font-bold uppercase tracking-wider brand-font">Repairs</p>
                            <h3 class="text-2xl md:text-3xl font-extrabold text-slate-900 brand-font" id="dash-maintenance">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-3xl shadow-sm border border-slate-100 h-80">
                        <h3 class="font-bold text-lg text-slate-800 mb-4 brand-font">Performance</h3>
                        <div class="h-64"><canvas id="revenueChart"></canvas></div>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-lg text-slate-800 mb-4 brand-font">Quick Actions</h3>
                        <div class="space-y-3">
                            <button id="qa-tenant" onclick="openModal('modal-tenant')" class="w-full flex items-center justify-between p-4 bg-blue-50 text-blue-700 rounded-2xl hover:bg-blue-100 transition"><span class="font-bold text-sm brand-font">Add Tenant</span><i class="fas fa-user-plus bg-blue-200 p-2 rounded-full text-xs"></i></button>
                            <button id="qa-invoice" onclick="openInvoiceModal()" class="w-full flex items-center justify-between p-4 bg-emerald-50 text-emerald-700 rounded-2xl hover:bg-emerald-100 transition"><span class="font-bold text-sm brand-font">Create Invoice</span><i class="fas fa-plus bg-emerald-200 p-2 rounded-full text-xs"></i></button>
                            <button onclick="openModal('modal-listing')" class="w-full flex items-center justify-between p-4 bg-indigo-50 text-indigo-700 rounded-2xl hover:bg-indigo-100 transition"><span class="font-bold text-sm brand-font">Post Listing</span><i class="fas fa-home bg-indigo-200 p-2 rounded-full text-xs"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. TENANTS -->
            <div id="view-tenants" class="view-section hidden-section fade-in">
                <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-slate-800 brand-font">Directory</h3><button onclick="openModal('modal-tenant')" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow hover:bg-blue-700 brand-font">+ Add</button></div>
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-x-auto w-full">
                    <table class="w-full text-left whitespace-nowrap"><thead class="bg-slate-50 text-slate-500 text-xs uppercase border-b border-slate-200 brand-font"><tr><th class="p-5">Tenant</th><th class="p-5">Unit</th><th class="p-5">Rent</th><th class="p-5 text-right">Status</th></tr></thead><tbody id="table-tenants" class="divide-y divide-slate-100"></tbody></table>
                </div>
            </div>

            <!-- 3. LISTINGS -->
            <div id="view-listings" class="view-section hidden-section fade-in">
                <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-slate-800 brand-font">Listings</h3><button onclick="openModal('modal-listing')" class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl text-sm font-semibold shadow hover:bg-indigo-700 brand-font">+ Post</button></div>
                <div id="grid-listings" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
            </div>

            <!-- 4. SCREENING -->
            <div id="view-screening" class="view-section hidden-section fade-in">
                <h3 class="text-xl font-bold text-slate-800 brand-font mb-4">Applicant Queue</h3>
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 w-full overflow-x-auto">
                    <table class="w-full text-left whitespace-nowrap">
                        <thead class="bg-white text-slate-500 text-xs uppercase border-b border-slate-200 brand-font">
                            <tr><th class="p-5">Applicant</th><th class="p-5">Score</th><th class="p-5">Income</th><th class="p-5 text-right">Action</th></tr>
                        </thead>
                        <tbody id="table-screening" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>

            <!-- 5. MESSAGES (MOBILE FRIENDLY LAYOUT) -->
            <div id="view-messages" class="view-section hidden-section fade-in h-[calc(100vh-140px)]">
                <div class="flex h-full bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden relative">
                    
                    <!-- List Panel -->
                    <div id="msg-list-panel" class="w-full md:w-1/3 border-r border-slate-200 bg-slate-50 flex flex-col">
                        <div class="p-4 border-b border-slate-200 bg-slate-50 font-bold text-slate-700 brand-font">Conversations</div>
                        <div id="list-chats" class="flex-1 overflow-y-auto p-2 space-y-2"></div>
                    </div>

                    <!-- Chat View -->
                    <div id="msg-view-panel" class="absolute inset-0 bg-white md:static w-full md:w-2/3 flex-col hidden md:flex z-20">
                        <div id="header-chat" class="p-4 border-b border-slate-200 bg-white font-bold text-slate-800 brand-font flex items-center gap-3">
                            <button onclick="backToChatList()" class="md:hidden text-slate-500 mr-2 p-2 rounded-full hover:bg-slate-100"><i class="fas fa-arrow-left"></i></button>
                            <span id="chat-title">Select a tenant</span>
                        </div>
                        <div id="box-chat" class="flex-1 p-4 md:p-6 overflow-y-auto bg-slate-50 space-y-4 custom-scroll"></div>
                        <div class="p-4 border-t border-slate-200 bg-white flex gap-2">
                            <input type="text" id="input-chat" class="flex-1 border p-3 rounded-full outline-none focus:ring-2 focus:ring-indigo-500 text-sm font-medium" placeholder="Type a message...">
                            <button onclick="sendMsg()" class="bg-indigo-600 text-white w-12 h-12 rounded-full font-bold flex items-center justify-center shadow-lg hover:bg-indigo-700 transition"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>

                </div>
            </div>

            <!-- 6. MAINTENANCE -->
            <div id="view-maintenance" class="view-section hidden-section fade-in">
                <h3 class="text-xl font-bold text-slate-800 mb-4 brand-font">Maintenance</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden"><div class="p-6 border-b bg-rose-50 border-rose-100"><h3 class="font-bold text-rose-800 brand-font">Active</h3></div><div id="list-maint-active" class="divide-y divide-slate-100"></div></div>
                    <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden"><div class="p-6 border-b bg-slate-50 border-slate-100"><h3 class="font-bold text-slate-700 brand-font">History</h3></div><div id="list-maint-history" class="divide-y divide-slate-100"></div></div>
                </div>
            </div>

            <!-- 7. PAYMENT RECORDS -->
            <div id="view-financials" class="view-section hidden-section fade-in">
                <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-slate-800 brand-font">Records</h3><button onclick="openInvoiceModal()" class="bg-emerald-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow hover:bg-emerald-700 brand-font">+ Invoice</button></div>
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 w-full overflow-x-auto">
                    <table class="w-full text-left whitespace-nowrap"><thead class="bg-slate-50 text-slate-500 text-xs uppercase border-b border-slate-200 brand-font"><tr><th class="p-5">ID</th><th class="p-5">Tenant</th><th class="p-5">Total</th><th class="p-5">Paid</th><th class="p-5 text-right">Status</th></tr></thead><tbody id="table-invoices" class="divide-y divide-slate-100"></tbody></table>
                </div>
            </div>

            <!-- 8. EXPENSES -->
            <div id="view-expenses" class="view-section hidden-section fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h3 class="text-xl font-bold text-slate-800 brand-font">Expenses</h3>
                    <div class="flex gap-3 w-full md:w-auto">
                        <select id="filter-expenses" onchange="renderExpenses()" class="border border-slate-300 rounded-xl px-3 py-2 text-sm bg-white flex-1 md:flex-none font-medium text-slate-600"><option value="all">All Properties</option></select>
                        <div class="bg-rose-50 text-rose-700 px-4 py-2 rounded-xl font-bold border border-rose-200 text-sm flex-1 md:flex-none text-center brand-font">Total: <span id="exp-total-display">$0.00</span></div>
                        <button onclick="populateExpenseModal(); openModal('modal-expense')" class="bg-rose-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow hover:bg-rose-700 flex-none brand-font">+ Add</button>
                    </div>
                </div>
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 w-full overflow-x-auto">
                    <table class="w-full text-left whitespace-nowrap">
                        <thead class="bg-slate-50 text-slate-500 text-xs uppercase border-b border-slate-200 brand-font"><tr><th class="p-5">Date</th><th class="p-5">Property</th><th class="p-5">Vendor</th><th class="p-5">Category</th><th class="p-5 text-right">Amount</th></tr></thead>
                        <tbody id="table-expenses" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>

            <!-- 9. REPORTS -->
            <div id="view-reports" class="view-section hidden-section fade-in">
                <h3 class="text-xl font-bold text-slate-800 brand-font mb-6">Reports</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                        <h4 class="font-bold text-lg text-slate-900 border-b pb-4 mb-4 brand-font">Income Statement</h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center"><span class="text-slate-600">Total Revenue</span><span class="font-bold text-emerald-600 text-lg brand-font" id="report-income">$0.00</span></div>
                            <div class="flex justify-between items-center"><span class="text-slate-600">Total Expenses</span><span class="font-bold text-rose-600 text-lg brand-font" id="report-expense">$0.00</span></div>
                            <div class="border-t pt-4 flex justify-between items-center mt-4"><span class="font-extrabold text-slate-800 brand-font">Net Operating Income</span><span class="font-extrabold text-indigo-900 text-2xl brand-font" id="report-noi">$0.00</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 10. SETTINGS -->
            <div id="view-settings" class="view-section hidden-section fade-in">
                <div class="bg-white rounded-3xl shadow-lg border border-slate-200 p-8 max-w-3xl mx-auto"><h3 class="text-2xl font-bold mb-8 brand-font">Settings</h3><div class="p-4 text-center text-slate-500 italic brand-font">Global settings available in next update.</div></div>
            </div>
        </div>
    </main>

    <!-- MODALS (Structure preserved, improved slightly for rounded corners) -->
    <div id="modal-tenant" class="hidden-section fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-lg relative"><button onclick="closeModal('modal-tenant')" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times text-xl"></i></button><h3 class="text-xl font-bold mb-6 brand-font">Add Tenant</h3><form onsubmit="act_saveTenant(event)" class="space-y-4"><input id="t-name" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Name" required><input id="t-email" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Email"><div class="flex gap-2"><input id="t-unit" class="w-1/2 border p-3 rounded-xl bg-slate-50" placeholder="Unit"><input id="t-rent" class="w-1/2 border p-3 rounded-xl bg-slate-50" placeholder="Rent"></div><input id="t-addr" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Address"><button class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold brand-font">Save</button></form></div></div>
    <div id="modal-invoice" class="hidden-section fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-lg relative"><button onclick="closeModal('modal-invoice')" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times text-xl"></i></button><h3 class="text-xl font-bold mb-6 brand-font">Invoice</h3><form onsubmit="act_addInvoice(event)" class="space-y-4"><select id="inv-tenant" class="w-full border p-3 rounded-xl bg-slate-50"></select><input id="inv-desc" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Description"><input id="inv-amount" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Amount"><input type="date" id="inv-date" class="w-full border p-3 rounded-xl bg-slate-50"><button class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold brand-font">Send</button></form></div></div>
    <div id="modal-listing" class="hidden-section fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-lg relative"><button onclick="closeModal('modal-listing')" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times text-xl"></i></button><h3 class="text-xl font-bold mb-6 brand-font">Listing</h3><form onsubmit="act_saveListing(event)" class="space-y-4"><input id="l-addr" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Address"><div class="flex gap-2"><input id="l-price" class="w-1/2 border p-3 rounded-xl bg-slate-50" placeholder="Price"><input id="l-sqft" class="w-1/2 border p-3 rounded-xl bg-slate-50" placeholder="Sqft"></div><div class="flex gap-2"><input id="l-beds" class="w-1/2 border p-3 rounded-xl bg-slate-50" placeholder="Beds"><input id="l-baths" class="w-1/2 border p-3 rounded-xl bg-slate-50" placeholder="Baths"></div><textarea id="l-desc" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Desc"></textarea><input id="l-amen" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Amenities"><input type="date" id="l-date" class="w-full border p-3 rounded-xl bg-slate-50"><button class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold brand-font">Post</button></form></div></div>
    <div id="modal-expense" class="hidden-section fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-lg relative"><button onclick="closeModal('modal-expense')" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times text-xl"></i></button><h3 class="text-xl font-bold mb-6 brand-font">Expense</h3><form onsubmit="act_addExpense(event)" class="space-y-4"><select id="ex-prop" class="w-full border p-3 rounded-xl bg-slate-50"></select><input type="date" id="ex-date" class="w-full border p-3 rounded-xl bg-slate-50"><input id="ex-vendor" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Vendor"><select id="ex-cat" class="w-full border p-3 rounded-xl bg-slate-50"><option>Repairs</option><option>Utilities</option><option>Tax</option></select><input id="ex-amount" class="w-full border p-3 rounded-xl bg-slate-50" placeholder="Amount"><button class="w-full bg-rose-600 text-white py-3 rounded-xl font-bold brand-font">Save</button></form></div></div>
    <div id="modal-maint-detail" class="hidden-section fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md relative"><button onclick="closeModal('modal-maint-detail')" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times text-xl"></i></button><h3 class="text-xl font-bold mb-2 brand-font">Request</h3><p id="md-issue" class="text-lg font-medium text-slate-800 mb-1 brand-font"></p><p id="md-meta" class="text-sm text-slate-500 mb-4"></p><div class="bg-slate-50 p-4 rounded-xl border border-slate-200 mb-4"><p class="text-xs font-bold text-slate-400 uppercase mb-1">Notes</p><p id="md-notes" class="text-sm text-slate-700 italic">None</p></div><button onclick="closeModal('modal-maint-detail')" class="w-full border border-slate-300 text-slate-600 py-2 rounded-xl font-bold hover:bg-slate-50 brand-font">Close</button></div></div>

    <!-- WELCOME MODAL -->
    <div id="modal-welcome" class="hidden-section fixed inset-0 bg-slate-900/90 z-50 flex items-center justify-center backdrop-blur-md fade-in px-4"><div class="bg-white p-10 rounded-3xl shadow-2xl max-w-lg text-center relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 to-blue-500"></div><div class="w-16 h-16 bg-indigo-50 rounded-2xl flex items-center justify-center mx-auto mb-6"><i class="fas fa-hand-sparkles text-3xl text-indigo-600"></i></div><h2 class="text-3xl font-extrabold text-slate-900 mb-4 brand-font">Welcome to Kozeyy</h2><p class="text-slate-600 mb-8 leading-relaxed">Your professional property management journey starts here. Let us show you how to automate your rentals in 5 easy steps.</p><button onclick="startTour()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-indigo-700 shadow-lg shadow-indigo-500/30 transition transform hover:-translate-y-1">Start Quick Tour</button><button onclick="endTour()" class="mt-4 text-sm text-slate-400 hover:text-slate-600">Skip for now</button></div></div>
    <!-- TOUR OVERLAYS -->
    <div id="tour-spotlight" class="hidden-section tour-spotlight"></div>
    <div id="tour-tooltip" class="hidden-section tour-tooltip"><div class="flex justify-between items-start mb-2"><h4 id="tour-title" class="font-bold text-lg text-slate-900"></h4><span id="tour-step" class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded">1/5</span></div><p id="tour-text" class="text-sm text-slate-600 mb-4 leading-relaxed"></p><div class="flex justify-end gap-2"><button onclick="endTour()" class="text-xs text-slate-400 hover:text-slate-600 mr-auto px-2">End</button><button onclick="nextStep()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-xs font-bold">Next</button></div></div>

    <script>
        // --- DUMMY DATA STATE ---
        let state = {
            tenants: [
                { id: 1, name: 'John Doe', email: 'john@example.com', unit: '101', rent: 2000, addr: '123 Main St' },
                { id: 2, name: 'Jane Smith', email: 'jane@example.com', unit: '102', rent: 2100, addr: '123 Main St' }
            ],
            invoices: [
                { id: 101, tenantId: 1, total: 2000, amountPaid: 2000, status: 'Paid', date: '2023-10-01', paidDate: '2023-10-01' },
                { id: 102, tenantId: 2, total: 2100, amountPaid: 0, status: 'Unpaid', date: '2023-11-01' }
            ],
            maint: [
                { id: 1, tenantId: 1, issue: 'Leaky Faucet', status: 'Active', date: '2023-10-15' }
            ],
            messages: [
                { id: 1, tenantId: 1, from: 'Tenant', text: 'Hey, when is rent due?', time: '10:00 AM' }
            ],
            expenses: [
                { id: 1, date: '2023-10-05', vendor: 'Home Depot', cat: 'Repairs', amount: 150, prop: '123 Main St' }
            ],
            listings: [],
            notifications: { messages: 1, maintenance: 1, screening: 0 },
            ftux: true
        };

        let currentChatId = null;
        let chartInstance = null;

        // --- TOUR ---
        const tourSteps = [
            { id: 'link-dashboard', title: 'Dashboard', text: 'Overview of revenue & occupancy.', render: 'dashboard' },
            { id: 'qa-tenant', title: 'Add Tenant', text: 'Quickly onboard new tenants.', render: 'dashboard' },
            { id: 'qa-invoice', title: 'Create Invoice', text: 'Generate bills in seconds.', render: 'dashboard' },
            { id: 'link-settings', title: 'Settings', text: 'Configure global late fees.', render: 'settings' },
            { id: 'link-messages', title: 'Messages', text: 'Chat securely with tenants.', render: 'messages', mock: true }
        ];

        function checkTour() { if(state.ftux) { document.getElementById('modal-welcome').classList.remove('hidden-section'); document.getElementById('modal-welcome').classList.add('flex'); } }
        function startTour() { document.getElementById('modal-welcome').classList.add('hidden-section'); document.getElementById('modal-welcome').classList.remove('flex'); tourStep = 0; runTourStep(); }
        function runTourStep() {
            const step = tourSteps[tourStep];
            navTo(step.render, true);
            if(step.mock) injectMockData(step.render);
            const el = document.getElementById(step.id);
            if(el) {
                el.scrollIntoView({behavior: "smooth", block: "center"});
                setTimeout(() => {
                    const spot = document.getElementById('tour-spotlight'); const tip = document.getElementById('tour-tooltip');
                    spot.classList.remove('hidden-section'); tip.classList.remove('hidden-section');
                    const rect = el.getBoundingClientRect();
                    spot.style.top = `${rect.top - 5}px`; spot.style.left = `${rect.left - 5}px`; spot.style.width = `${rect.width + 10}px`; spot.style.height = `${rect.height + 10}px`;
                    let tipTop = rect.bottom + 15; let tipLeft = rect.left;
                    if(window.innerWidth < 768) { tipLeft = 10; tip.style.width = 'calc(100% - 20px)'; } 
                    else if(tipLeft + 280 > window.innerWidth) tipLeft = window.innerWidth - 300;
                    tip.style.top = `${tipTop}px`; tip.style.left = `${tipLeft}px`;
                    document.getElementById('tour-title').innerText = step.title; document.getElementById('tour-text').innerText = step.text; document.getElementById('tour-step').innerText = `${tourStep + 1}/5`;
                }, 400);
            }
        }
        function injectMockData(v) { if(v === 'messages') { document.getElementById('list-chats').innerHTML = `<div class="p-4 bg-white border border-slate-200 rounded-xl font-bold">John Doe</div>`; document.getElementById('box-chat').innerHTML = `<div class="flex"><div class="bg-white border p-3 rounded-xl text-sm mb-2 shadow-sm">Hi, picking up keys tomorrow?</div></div>`; } }
        function nextStep() { tourStep++; if(tourStep >= tourSteps.length) { endTour(); return; } runTourStep(); }
        function endTour() { 
            const wel = document.getElementById('modal-welcome'); 
            if(wel) { wel.classList.add('hidden-section'); wel.classList.remove('flex'); }
            document.getElementById('tour-spotlight').classList.add('hidden-section'); 
            document.getElementById('tour-tooltip').classList.add('hidden-section'); 
            state.ftux = false; navTo('dashboard'); 
        }
        function restartTour() { state.ftux = true; location.reload(); }

        // --- MOBILE NAV TOGGLE ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        // --- NAVIGATION ---
        function navTo(view, isTour = false) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden-section'));
            document.getElementById('view-' + view).classList.remove('hidden-section');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('sidebar-active'));
            const link = document.getElementById('link-' + view);
            if(link) link.classList.add('sidebar-active');

            // Header Title Logic (Mobile "Menu" vs Desktop "Title")
            const titles = { dashboard: 'Portfolio Overview', tenants: 'Tenant Directory', listings: 'Property Listings', screening: 'Applicant Queue', messages: 'Communication Center', maintenance: 'Maintenance Requests', financials: 'Payment Records', expenses: 'Expense Tracker', reports: 'Financial Reports', settings: 'System Configuration' };
            document.getElementById('desktop-page-title').innerText = titles[view] || 'Dashboard';

            // Close sidebar on mobile
            if(window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('-translate-x-full');
                document.getElementById('mobile-overlay').classList.add('hidden');
            }

            if (!isTour) {
                if(view === 'financials') renderInvoices();
                if(view === 'expenses') { populateExpenseModal(); renderExpenses(); }
                if(view === 'messages') { 
                    renderChatList(); 
                    backToChatList(); 
                }
                if(view === 'reports') { renderAll(); }
            }
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden-section'); document.getElementById(id).classList.add('flex'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden-section'); document.getElementById(id).classList.remove('flex'); resetForms(); }
        function resetForms() { editTenantId = null; editListingId = null; document.getElementById('btn-save-tenant').innerText="Save"; document.getElementById('btn-save-listing').innerText="Post"; }

        // --- RENDER LOGIC ---
        function renderAll() {
            // Dashboard
            const revenue = state.invoices.filter(i=>i.status==='Paid').reduce((a,b)=>a+(b.amountPaid||0),0);
            const outstanding = state.invoices.filter(i=>i.status!=='Paid').reduce((a,b)=>a+(b.total - (b.amountPaid||0)), 0);
            document.getElementById('dash-revenue').innerText = `$${revenue.toLocaleString()}`;
            document.getElementById('dash-outstanding').innerText = `$${outstanding.toLocaleString()}`;
            document.getElementById('dash-occupancy').innerText = state.tenants.length > 0 ? "100%" : "0%";
            document.getElementById('dash-maintenance').innerText = state.maint.filter(m=>m.status==='Active').length;

            // Tenants
            const tbody = document.getElementById('table-tenants'); tbody.innerHTML = '';
            state.tenants.forEach(t => {
                tbody.innerHTML += `<tr class="border-b border-slate-100"><td class="p-5 font-bold">${t.name}<br><span class="text-xs text-slate-400 font-normal">${t.email}</span></td><td class="p-5 text-sm">${t.unit}</td><td class="p-5 text-sm">$${parseInt(t.rent).toLocaleString()}</td><td class="p-5 text-right"><span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded text-xs font-bold brand-font uppercase">Active</span></td></tr>`;
            });

            // Maint
            const mList = document.getElementById('list-maint-active'); 
            mList.innerHTML = '';
            state.maint.filter(m=>m.status==='Active').forEach(m => {
                mList.innerHTML += `<div class="p-4 bg-white border border-slate-100 rounded-xl flex justify-between items-center mb-2 shadow-sm"><div><p class="font-bold text-slate-800 brand-font">${m.issue}</p><p class="text-xs text-slate-500">Unit 101 â€¢ ${m.date}</p></div><button class="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-lg text-xs font-bold brand-font">Done</button></div>`;
            });

            renderInvoices();
            initChart();
        }

        function renderInvoices() {
            const t = document.getElementById('table-invoices'); t.innerHTML='';
            state.invoices.forEach(i => {
                const tn = state.tenants.find(x=>x.id==i.tenantId) || {name:'Unknown'};
                t.innerHTML+=`<tr class="border-b border-slate-100"><td class="p-5 text-sm">#${i.id}</td><td class="p-5 text-sm font-bold">${tn.name}</td><td class="p-5 text-sm text-slate-500">Rent</td><td class="p-5 font-bold">$${i.total}</td><td class="p-5 text-emerald-600 font-bold">$${i.amountPaid}</td><td class="p-5 text-right text-sm">${i.status}</td></tr>`;
            });
        }

        function renderExpenses() {
            const t = document.getElementById('table-expenses'); t.innerHTML='';
            let total = 0;
            state.expenses.forEach(x => {
                total += x.amount;
                t.innerHTML += `<tr class="border-b border-slate-100"><td class="p-5 whitespace-nowrap">${x.date}</td><td class="p-5 text-sm">${x.prop}</td><td class="p-5 text-sm font-bold">${x.vendor}</td><td class="p-5 text-sm"><span class="bg-slate-100 px-2 py-1 rounded-lg text-xs font-bold brand-font">${x.cat}</span></td><td class="p-5 text-right font-bold text-rose-600">$${x.amount}</td></tr>`;
            });
            document.getElementById('exp-total-display').innerText = `$${total.toLocaleString()}`;
        }

        // --- ACTIONS ---
        function act_saveTenant(e) {
            e.preventDefault();
            state.tenants.push({
                id: Date.now(),
                name: document.getElementById('t-name').value,
                email: document.getElementById('t-email').value,
                unit: document.getElementById('t-unit').value,
                rent: document.getElementById('t-rent').value,
                addr: document.getElementById('t-addr').value
            });
            closeModal('modal-tenant');
            renderAll();
            alert("Tenant added (Demo Mode)");
        }

        function act_addInvoice(e) { e.preventDefault(); alert("Invoice sent (Demo Mode)"); closeModal('modal-invoice'); }
        function act_addExpense(e) { 
            e.preventDefault(); 
            state.expenses.push({
                date: document.getElementById('ex-date').value,
                vendor: document.getElementById('ex-vendor').value,
                cat: document.getElementById('ex-cat').value,
                amount: parseFloat(document.getElementById('ex-amount').value),
                prop: document.getElementById('ex-prop').value
            });
            closeModal('modal-expense'); 
            renderExpenses();
        }
        function act_saveListing(e) { e.preventDefault(); alert("Listing Posted"); closeModal('modal-listing'); }

        function openInvoiceModal() {
            const s = document.getElementById('inv-tenant'); s.innerHTML = '<option value="">Select Tenant</option>';
            state.tenants.forEach(t => { s.innerHTML += `<option value="${t.id}">${t.name}</option>`; });
            openModal('modal-invoice');
        }

        function populateExpenseModal() {
            const s = document.getElementById('ex-prop'); s.innerHTML = '<option disabled selected>Select Property</option>';
            state.tenants.forEach(t => s.innerHTML += `<option>${t.addr}</option>`);
        }

        // --- MESSAGING LOGIC (MOBILE OPTIMIZED) ---
        function renderChatList() { 
            const l=document.getElementById('list-chats'); l.innerHTML=''; 
            state.tenants.forEach(t=> l.innerHTML+=`<div onclick="openChat(${t.id})" class="p-4 bg-white border border-slate-200 rounded-2xl cursor-pointer hover:bg-slate-50 font-bold text-sm mb-2 shadow-sm flex justify-between items-center transition"><span>${t.name}</span><i class="fas fa-chevron-right text-slate-300 text-xs"></i></div>`); 
        }
        
        function openChat(id) { 
            currentChatId=id; 
            document.getElementById('chat-title').innerText = state.tenants.find(x=>x.id==id).name; 
            renderMessages();
            
            // Mobile: Hide List, Show View
            if(window.innerWidth < 768) {
                document.getElementById('msg-list-panel').classList.add('hidden');
                document.getElementById('msg-view-panel').classList.remove('hidden');
                document.getElementById('msg-view-panel').classList.add('flex');
            }
        }

        function backToChatList() {
            // Mobile: Hide View, Show List
            if(window.innerWidth < 768) {
                document.getElementById('msg-view-panel').classList.add('hidden');
                document.getElementById('msg-view-panel').classList.remove('flex');
                document.getElementById('msg-list-panel').classList.remove('hidden');
            }
        }

        function renderMessages() { 
            const b=document.getElementById('box-chat'); b.innerHTML=''; 
            state.messages.filter(m=>m.tenantId==currentChatId).forEach(m=>{ 
                b.innerHTML+=`<div class="flex w-full"><div class="px-4 py-3 rounded-2xl text-sm shadow-sm max-w-[85%] ${m.from==='Owner'?'ml-auto bg-indigo-600 text-white rounded-br-none':'mr-auto bg-white border border-slate-200 rounded-bl-none'}">${m.text}</div></div>`; 
            }); 
            b.scrollTop = b.scrollHeight;
        }
        function sendMsg() { 
            const i=document.getElementById('input-chat'); 
            if(i.value && currentChatId) { 
                state.messages.push({id:Date.now(), tenantId:currentChatId, from:'Owner', text:i.value}); 
                i.value=''; 
                renderMessages(); 
            } 
        }

        // --- CHARTS ---
        function initChart() { 
            if(chartInstance) chartInstance.destroy();
            const ctx = document.getElementById('revenueChart').getContext('2d'); 
            chartInstance = new Chart(ctx, { 
                type: 'bar', 
                data: { labels: ['Collected', 'Outstanding'], datasets: [{ label: 'Financials', data: [4100, 0], backgroundColor: ['#10b981', '#f59e0b'], borderRadius: 6 }] }, 
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } 
            }); 
        }

        function hardReset() { if(confirm("Factory Reset?")) { localStorage.removeItem(DB_KEY); location.reload(); } }
        function clearNotifications() { state.notifications = { messages: 0, maintenance: 0, screening: 0 }; DB.set(state); renderAll(); }
        
        // Init App & Tour
        checkTour();
        renderAll();
    </script>
</body>
</html>
